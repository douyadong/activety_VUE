function PublishSuccessController(){Controller.call(this),this.initPage(),this.getDetails(),this.bindEvent()}PublishSuccessController.prototype.initPage=function(){var t=this;t.openId=t.getQueryStringByName("openId");new WechatShareController({linkUrl:t.redirectUrl.annualmeeting.share+"?shareOpenId="+t.openId});t.request(t.apiUrl.annualmeeting.getHotPhotos+"?openId="+t.openId,{},{process:function(i){i.data.length&&($(".list-box").append('<div class="title">其他征集作品</div>'),$(".list-box").append('<a class="link_more">查看更多</a>'),$(".list-box").find(".link_more").attr("href","/ay/index.php?openId="+t.openId),$(".list-box").append('<div class="list"></div>'),$.each(i.data,function(i,e){if(i<2){var a=t.createListItem(e);a&&a.length&&$(".list-box").find(".list").append(a)}}))}})},PublishSuccessController.prototype.initSwiper=function(){new Swiper(".swiper-container",{direction:"horizontal",loop:!0,pagination:".swiper-pagination"})},PublishSuccessController.prototype.getDetails=function(){var t,i=this,e=$(".swiper-wrapper");i.request(i.apiUrl.annualmeeting.getPhotoInfoByOpenId,{openId:i.openId},{process:function(a){a&&a.data&&a.data.length>0&&($.each(a.data,function(i,a){t=$('<div class="swiper-slide"></div>'),t.append('<img src="'+a.thumbnailUrl+'" alt="'+a.userName+'">'),t.find("img").attr("data-info",JSON.stringify(a)).attr("data-id",a.id),e.append(t)}),$(".img-box").show(),i.initSwiper())}})},PublishSuccessController.prototype.createPhotoContent=function(t){var i=this,e=[];return t?(e.push('<i class="close sprite sprite-4"></i>'),e.push('<div class="image">'),e.push('<img src="'+t.imgUrl+'" alt="">'),e.push("</div>"),e.push('<div class="location">'),e.push('<span class="content"><i class="sprite sprite-15"></i><span>'+t.country+"."+t.city+"</span></span>"),e.push('<i class="triangel"></i>'),e.push("</div>"),e.push('<div class="vote" data-id='+t.id+" data-isvote="+t.isVote+" data-info="+JSON.stringify(t)+">"),e.push('<p class="name">'+t.userName+"</p>"),e.push('<p class="zan">'),t.isVote?(e.push('<img src="'+i.staticDomain+'/ay/images/heart1.png" alt="heart">'),e.push("<span>恭喜你投票成功</span></p>")):(e.push('<img src="'+i.staticDomain+'/ay/images/heart2.png" alt="heart">'),e.push("<span>点击为TA投票</span></p>")),e.push('<p class="count">目前票数 '+t.thumbs+"</p>"),e.push("</div>"),void $(".photo-dialog").empty().append(e.join(""))):e},PublishSuccessController.prototype.createMask=function(){var t=document.documentElement.scrollHeight,i=document.documentElement.scrollWidth,e=document.createElement("div");e.id="mask-container",$(e).css({"background-color":"rgba(0,0,0,0.7)",position:"fixed",left:0,top:0,height:t+"px",width:i+"px","z-index":"1000",cursor:"pointer"}),$(document.body).append(e)},PublishSuccessController.prototype.createListItem=function(t){var i=this,e=[];return t?(e.push('<div class="image" data-id='+t.id+" data-openid="+t.openId+" data-info="+JSON.stringify(t)+">"),e.push('<img src="'+t.thumbnailUrl+'" alt="">'),e.push('<div class="location">'),e.push('<span class="content"><i class="sprite sprite-15"></i><span>'+t.country+"."+t.city+"</span></span>"),e.push('<i class="triangel"></i>'),e.push("</div>"),e.push('<div class="zan">'),e.push('<div class="left">'),e.push('<img src="'+i.staticDomain+'/ay/images/heart1.png" alt="heart">'),e.push("</div>"),e.push('<div class="right">'),e.push('<span class="count">'+t.thumbs+"</span>"),e.push('<span class="name">'+t.userName+"</span>"),e.push("</div>"),e.push("</div>"),e.push("</div>"),e.join("")):e},PublishSuccessController.prototype.bindEvent=function(){var t=this;$(".dialog").on("click",".sprite-4",function(t){t.preventDefault(),$(".dialog").hide(),$("#mask-container").remove()}),$(".swiper-wrapper").on("click",".swiper-slide img",function(i){i.preventDefault();var e=$(this).attr("data-info");$(".dialog").hide(),e.length>0&&(t.createPhotoContent($.parseJSON(e)),t.createMask(),$(".photo-dialog").fadeIn())}),$(".list-box").on("click",".image",function(i){i.preventDefault();var e=$(this).attr("data-openid");e&&(window.location.href=t.redirectUrl.annualmeeting.share+"?shareOpenId="+e)}),$(".photo-dialog").on("click",".vote",function(i){i.preventDefault();var e=$(this),a=parseInt(e.attr("data-isvote")),s=$.parseJSON(e.attr("data-info")),n=parseInt(e.attr("data-id")),o="",r={openId:t.openId,photoId:n},p={process:function(i){a?(e.attr("data-isvote",0),s.isVote=0,s.thumbs=s.thumbs-1,e.find("img").attr("src",t.staticDomain+"/ay/images/heart2.png"),e.find("p.count").text("目前票数 "+s.thumbs),e.find(".zan span").text("点击为TA投票")):(e.attr("data-isvote",1),s.isVote=1,s.thumbs=s.thumbs+1,e.find("img").attr("src",t.staticDomain+"/ay/images/heart1.png"),e.find("p.count").text("目前票数 "+s.thumbs),e.find(".zan span").text("恭喜你投票成功")),e.attr("data-info",JSON.stringify(s)),$(".swiper-wrapper").find('img[data-id="'+n+'"]').attr("data-info",JSON.stringify(s))},onExceptionInterface:function(i){t.tips(i.message)}};o=a?t.apiUrl.annualmeeting.delThumbs:t.apiUrl.annualmeeting.addThumbs,t.request(o,r,p)}),$("body").delegate("#mask-container","click",function(t){$(".dialog").hide(),$("#mask-container").remove()})},$(document).ready(function(){new PublishSuccessController});