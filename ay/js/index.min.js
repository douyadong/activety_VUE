function IndexController(){Controller.call(this),this.initPage(),this.initStar(),this.bindEvent(),this.initAnimation()}IndexController.prototype.initPage=function(){var t=this;t.pageIndex=parseInt($(".new").attr("pageindex")),t.pageSize=parseInt($(".new").attr("pagesize")),t.openId=t.getQueryStringByName("openId");new WechatShareController({linkUrl:t.redirectUrl.annualmeeting.index});t.request(t.apiUrl.annualmeeting.getCityCount,{},{process:function(t){$(".lighted").find("span.count").text(t.data)}}),t.request(t.apiUrl.annualmeeting.getHotPhotos+"?openId="+t.openId,{},{process:function(e){e.data.length&&($(".hot").append('<p class="title">热门照片</p>'),$.each(e.data,function(e,n){var a=t.createListItem(n);a&&a.length&&$(".hot").append(a)}),t.initStar())}}),t.request(t.apiUrl.annualmeeting.getNewPhotos+"?pageIndex="+t.pageIndex+"&pageSize="+t.pageSize+"&openId="+t.openId,{},{process:function(e){e.data.length&&($(".new").append('<p class="title">最新发布</p>'),$.each(e.data,function(e,n){var a=t.createListItem(n);a&&a.length&&$(".new").append(a)}),t.initStar(),t.initPullload())}})},IndexController.prototype.initAnimation=function(){var t=function(){$(".rule .image").animate({top:"-1.7rem"},1e3).animate({top:"-1.3rem"},1e3)};t(),si=setInterval(function(){t()},2e3)},IndexController.prototype.initStar=function(){$("#star").length&&$("#star").remove(),$("body").append('<div id="star"></div>'),$("#star").height($(document).height()).starfield({starDensity:1,mouseScale:1,seedMovement:!1}).height(0)},IndexController.prototype.initPullload=function(){var t=this;$(".new").pullload({apiUrl:t.apiUrl.annualmeeting.getNewPhotos+"?openId="+t.openId,crossDomain:"jsonp",threshold:0,requestLoadedKey:"pageIndex",callback:function(e){$.each(e.data,function(e,n){var a=t.createListItem(n);a&&a.length&&$(".new").append(a)}),t.initStar()}})},IndexController.prototype.createListItem=function(t){var e=this,n=[];return t?(n.push('<div class="image" data-id='+t.id+" data-info="+JSON.stringify(t)+">"),n.push('<img src="'+t.thumbnailUrl+'" alt="">'),n.push('<div class="location">'),n.push('<span class="content"><i class="sprite sprite-15"></i><span>'+t.country+"."+t.city+"</span></span>"),n.push('<i class="triangel"></i>'),n.push("</div>"),n.push('<div class="zan">'),n.push('<div class="left">'),n.push('<img src="'+e.staticDomain+'/ay/images/heart1.png" alt="heart">'),n.push("</div>"),n.push('<div class="right">'),n.push('<span class="count">'+t.thumbs+"</span>"),n.push('<span class="name">'+t.userName+"</span>"),n.push("</div>"),n.push("</div>"),n.push("</div>"),n.join("")):n},IndexController.prototype.createPhotoContent=function(t){var e=this,n=[];return t?(n.push('<i class="close sprite sprite-4"></i>'),n.push('<div class="image">'),n.push('<img src="'+t.imgUrl+'" alt="">'),n.push("</div>"),n.push('<div class="location">'),n.push('<span class="content"><i class="sprite sprite-15"></i><span>'+t.country+"."+t.city+"</span></span>"),n.push('<i class="triangel"></i>'),n.push("</div>"),n.push('<div class="vote" data-id='+t.id+" data-isvote="+t.isVote+" data-info="+JSON.stringify(t)+">"),n.push('<p class="name">'+t.userName+"</p>"),n.push('<p class="zan">'),t.isVote?(n.push('<img src="'+e.staticDomain+'/ay/images/heart1.png" alt="heart">'),n.push("<span>恭喜你投票成功</span></p>")):(n.push('<img src="'+e.staticDomain+'/ay/images/heart2.png" alt="heart">'),n.push("<span>点击为TA投票</span></p>")),n.push('<p class="count">目前票数 '+t.thumbs+"</p>"),n.push("</div>"),void $(".photo-dialog").empty().append(n.join(""))):n},IndexController.prototype.createMask=function(){var t=document.documentElement.scrollHeight,e=document.documentElement.scrollWidth,n=document.createElement("div");n.id="mask-container",$(n).css({"background-color":"rgba(0,0,0,0.7)",position:"fixed",left:0,top:0,height:t+"px",width:e+"px","z-index":"1000",cursor:"pointer"}),$(document.body).append(n)},IndexController.prototype.bindEvent=function(){var t=this;$(".rule").on("click",".image",function(e){e.preventDefault(),t.createMask(),$(".award-dialog").fadeIn()}),$(".dialog").on("click",".sprite-4",function(t){t.preventDefault(),$(".dialog").hide(),$("#mask-container").remove()}),$(".operation").on("click",".add",function(e){e.preventDefault(),window.location.href="publish.html?openId="+t.openId}),$(".operation").on("click",".my",function(e){e.preventDefault(),t.request(t.apiUrl.annualmeeting.getPhotoInfoByOpenId,{openId:t.openId},{process:function(e){e&&e.data&&e.data.length>0?window.location.href="success.html?openId="+t.openId:t.tips("您还没有上传照片")}})}),$("body").delegate("#mask-container","click",function(t){$(".dialog").hide(),$("#mask-container").remove()}),$(".hot,.new").on("click",".image",function(e){e.preventDefault();var n=$(this).attr("data-info");$(".dialog").hide(),n.length>0&&(t.createPhotoContent($.parseJSON(n)),t.createMask(),$(".photo-dialog").fadeIn())}),$(".photo-dialog").on("click",".vote",function(e){e.preventDefault();var n=$(this),a=parseInt(n.attr("data-isvote")),i=$.parseJSON(n.attr("data-info")),o=parseInt(n.attr("data-id")),s="",r={openId:t.openId,photoId:o},p={process:function(e){a?(n.attr("data-isvote",0),i.isVote=0,i.thumbs=parseInt(i.thumbs)-1,n.find("img").attr("src",t.staticDomain+"/ay/images/heart2.png"),n.find("p.count").text("目前票数 "+i.thumbs),n.find(".zan span").text("点击为TA投票")):(n.attr("data-isvote",1),i.isVote=1,i.thumbs=parseInt(i.thumbs)+1,n.find("img").attr("src",t.staticDomain+"/ay/images/heart1.png"),n.find("p.count").text("目前票数 "+i.thumbs),n.find(".zan span").text("恭喜你投票成功")),n.attr("data-info",JSON.stringify(i)),$(".hot,.new").find('.image[data-id="'+o+'"]').attr("data-info",JSON.stringify(i)),$(".hot,.new").find('.image[data-id="'+o+'"]').find(".count").text(i.thumbs)},onExceptionInterface:function(e){t.tips(e.message)}};s=a?t.apiUrl.annualmeeting.delThumbs:t.apiUrl.annualmeeting.addThumbs,t.request(s,r,p)})},$(document).ready(function(){new IndexController});