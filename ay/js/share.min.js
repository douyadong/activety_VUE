function ShareController(){Controller.call(this),this.initPage(),this.initStar(),this.getDetails(),this.bindEvent()}ShareController.prototype.initPage=function(){var t=this;t.openId=t.getQueryStringByName("openId"),t.shareOpenId=t.getQueryStringByName("shareOpenId");var e=$(".link_more").attr("href")+"?openId="+t.openId;$(".link_more").attr("href",e);new WechatShareController({canShareTimeline:!1,canShareAppMessage:!1})},ShareController.prototype.initStar=function(){$("#star").length&&$("#star").remove(),$("body").append('<div id="star"></div>'),$("#star").height($(document).height()).starfield({starDensity:1,mouseScale:1,seedMovement:!1}).height(0)},ShareController.prototype.initSwiper=function(){new Swiper(".swiper-container",{direction:"horizontal",loop:!0,pagination:".swiper-pagination"})},ShareController.prototype.getDetails=function(){var t,e=this,a=$(".swiper-wrapper");e.request(e.apiUrl.annualmeeting.getPhotoInfoByOpenId,{openId:e.shareOpenId},{process:function(i){i&&i.data&&i.data.length>0&&($.each(i.data,function(e,i){t=$('<div class="swiper-slide"></div>'),t.append('<img src="'+i.thumbnailUrl+'" alt="'+i.userName+'">'),t.find("img").attr("data-info",JSON.stringify(i)).attr("data-id",i.id),a.append(t)}),$(".img-box").show(),e.initSwiper(),e.initStar())}})},ShareController.prototype.createPhotoContent=function(t){var e=this,a=[];return t?(a.push('<i class="close sprite sprite-4"></i>'),a.push('<div class="image">'),a.push('<img src="'+t.imgUrl+'" alt="">'),a.push("</div>"),a.push('<div class="location">'),a.push('<span class="content"><i class="sprite sprite-15"></i><span>'+t.country+"."+t.city+"</span></span>"),a.push('<i class="triangel"></i>'),a.push("</div>"),a.push('<div class="vote" data-id='+t.id+" data-isvote="+t.isVote+" data-info="+JSON.stringify(t)+">"),a.push('<p class="name">'+t.userName+"</p>"),a.push('<p class="zan">'),t.isVote?(a.push('<img src="'+e.staticDomain+'/ay/images/heart1.png" alt="heart">'),a.push("<span>恭喜你投票成功</span></p>")):(a.push('<img src="'+e.staticDomain+'/ay/images/heart2.png" alt="heart">'),a.push("<span>点击为TA投票</span></p>")),a.push('<p class="count">目前票数 '+t.thumbs+"</p>"),a.push("</div>"),void $(".photo-dialog").empty().append(a.join(""))):a},ShareController.prototype.createMask=function(){var t=document.documentElement.scrollHeight,e=document.documentElement.scrollWidth,a=document.createElement("div");a.id="mask-container",$(a).css({"background-color":"rgba(0,0,0,0.7)",position:"fixed",left:0,top:0,height:t+"px",width:e+"px","z-index":"1000",cursor:"pointer"}),$(document.body).append(a)},ShareController.prototype.bindEvent=function(){var t=this;$(".dialog").on("click",".sprite-4",function(t){t.preventDefault(),$(".dialog").hide(),$("#mask-container").remove()}),$(".swiper-wrapper").on("click",".swiper-slide img",function(e){e.preventDefault();var a=$(this).attr("data-info");$(".dialog").hide(),a.length>0&&(t.createPhotoContent($.parseJSON(a)),t.createMask(),$(".photo-dialog").fadeIn())}),$(".button").on("click",function(){window.location.href=t.redirectUrl.annualmeeting.index}),$(".photo-dialog").on("click",".vote",function(e){e.preventDefault();var a=$(this),i=parseInt(a.attr("data-isvote")),n=$.parseJSON(a.attr("data-info")),r=parseInt(a.attr("data-id")),o="",s={openId:t.openId,photoId:r},p={process:function(e){i?(a.attr("data-isvote",0),n.isVote=0,n.thumbs=n.thumbs-1,a.find("img").attr("src",t.staticDomain+"/ay/images/heart2.png"),a.find("p.count").text("目前票数 "+n.thumbs),a.find(".zan span").text("点击为TA投票")):(a.attr("data-isvote",1),n.isVote=1,n.thumbs=n.thumbs+1,a.find("img").attr("src",t.staticDomain+"/ay/images/heart1.png"),a.find("p.count").text("目前票数 "+n.thumbs),a.find(".zan span").text("恭喜你投票成功")),a.attr("data-info",JSON.stringify(n)),$(".swiper-wrapper").find('img[data-id="'+r+'"]').attr("data-info",JSON.stringify(n))},onExceptionInterface:function(e){t.tips(e.message)}};o=i?t.apiUrl.annualmeeting.delThumbs:t.apiUrl.annualmeeting.addThumbs,t.request(o,s,p)}),$("body").delegate("#mask-container","click",function(t){$(".dialog").hide(),$("#mask-container").remove()})},$(document).ready(function(){new ShareController});