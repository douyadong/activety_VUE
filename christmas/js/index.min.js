function IndexController(){this.init(),this.bindEvent(),this.initLoading()}IndexController.prototype.createMask=function(){var t=document.documentElement.scrollHeight,e=document.documentElement.scrollWidth,n=document.createElement("div");n.id="mask-container",$(n).css({"background-color":"rgba(0,0,0,0.7)",position:"fixed",left:0,top:0,height:t+"px",width:e+"px","z-index":"999",cursor:"pointer"}),$(document.body).append(n)},IndexController.prototype.init=function(){var t=this;$("[name='wechatUrl']").val(window.location.href);var e=t.getQueryStringByName("bg"),n=t.getQueryStringByName("text"),a=t.getQueryStringByName("name");if(e&&n&&a){$("#loading").hide(),$("#content").show(),$("#content").removeAttr("class").addClass(e),$("#menu").hide(),$("#content").attr("text",n);var o='<img src="images/'+n+'.png">                            <div>                                '+a+"                            </div>";$("#content").find(".text").html("").html(o).find("div").show(),$("#makeup").show(),$("[name='text']").val(t.getQueryStringByName("text")),$("[name='username']").val(t.getQueryStringByName("name")),$("[name='wechatTitle']").val("Merry Christmas 我愿为你种星辰"),$("[name='wechatUrl']").val(window.location.href),t.html2Canvans(),$("#content").hide()}else $("#loading").show(),$("#content").hide()},IndexController.prototype.html2Canvans=function(){var t=this;html2canvas(document.body,{onrendered:function(e){document.body.appendChild(e);var n=t.convertCanvasToImage(document.getElementsByTagName("canvas")[0]);$(document.getElementsByTagName("canvas")[0]).hide(),$("body").append(n).addClass("save-img")}})},IndexController.prototype.initChooseBg=function(){new Swiper("#swiperBg",{direction:"horizontal",loop:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",onSlideChangeEnd:function(t,e){var n=t.activeIndex;5==t.activeIndex&&(n=1),$(".text").html(""),$("#content").removeAttr("class").addClass("bg_"+n)}})},IndexController.prototype.initChooseText=function(){new Swiper("#swiperText",{direction:"horizontal",loop:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",onSlideChangeEnd:function(t,e){$("[name='username']").val("");var n=t.activeIndex;5==t.activeIndex&&(n=1);var a='<img src="images/text_'+n+'.png">                            <div>                                <div class="animate"><i></i>                                <input type="text" placeholder="输入姓名" id="name"></div>                                <p>(输入10个字符以内的名字)</p>                            </div>';$("#content").removeAttr("text").attr("text","text_"+n),$("#content").find(".text").html("").html(a)}})},IndexController.prototype.bindEvent=function(){var t=this;$("#menu a[data-number=1]").click(function(){$("#chooseBg").show(),$("#chooseText").hide(),$("[name='bg']").val("bg_1"),$("[name='text']").val(""),$(this).find(".tip").hide(),$("#mask-container").remove(),t.initChooseBg()}),document.getElementsByTagName("body")[0].ontouchstart=function(){"0"==$("#audio").attr("data-number")&&document.getElementById("audio").play(),$("#audio").attr("data-number","1")},$("#menu a[data-number=2]").click(function(){$("#chooseText").show(),$("#chooseBg").hide(),$("#mask-container").remove(),$("#menu .tip[data-number='2']").hide(),t.initChooseText()}),$(".lick-btn").click(function(){var e=$(this).attr("data-number");"1"==e?($("[name = 'bg']").val($("#content").attr("class")),$("#chooseBg").hide(),t.createMask(),$("#menu .tip[data-number='2']").show()):($("[name = 'text']").val($("#content").attr("text")),$("#chooseText").hide(),$(".text > div").fadeIn("slow"))}),$("#start").click(function(){$("#loading").hide(),$("#content").fadeIn(),t.createMask(),$(".tip[data-number='1']").show()}),$("#showItems").click(function(){$("#items").fadeIn()}),$("#items").click(function(){$("#items").fadeOut()}),$("#submitContrct").click(function(){$("[name='contract']").is(":checked")?($("#contract").hide(),$("#content .text>div").html("").html($("[name='username']").val()),$("[name='wechatTitle']").val("Merry Christmas 我愿为你种星辰"),$("[name='wechatContent']").val($("[name='username']").val()+"已经把对你的祝福种进悟空「圣诞星辰卡」，快打开看看吧~"),$("[name='wechatUrl']").val(window.location.href+"?bg="+$("[name='bg']").val()+"&text="+$("[name='text']").val()+"&name="+$("[name='username']").val()),$("#menu").hide(),t.html2Canvans(),$("#content").hide(),$("#makeup").show(),$("#guide").show()):(t.tips("请勾选并同意！"),$("#contract").hide())}),$("body").delegate("#name","change",function(){$("[name='username']").val($(this).val())}),$("#guide").click(function(){$(this).hide()}),$("#tipsSubmit").click(function(){$("#tips").fadeOut(),$("[name='contract']").is(":checked")||$("#contract").show()}),window.addEventListener("resize",function(t){var e=$("#name");e[0].scrollIntoView(!1)}),$("body").delegate("#name","click",function(){$(this).parents(".animate").removeClass("animate")}),$("#submit").click(function(){if(!$("[name='text']").val())return t.tips("请先选个祝福!"),!1;if(!$("[name='username']").val())return t.tips("请填写姓名!"),!1;var e=/^[a-zA-Z\/ ]{1,10}$/;return e.test($("#name").val())?void $("#contract").fadeIn():(t.tips("姓名最多10个英文字符!"),!1)})},IndexController.prototype.initLoading=function(){var t=setInterval(function(){var e=$("#processInner").width(),n=parseInt($("#loadfont").text().split("%")[0]);if(e>=200){clearInterval(t),$("#man").fadeOut(),$("#process").fadeOut(),$("#loadfont").fadeOut();setTimeout(function(){$("#start").css("bottom","10px")},300)}else $("#processInner").width(e+2),$("#loadfont").text(n+1+"%"),$("#man img").css("margin-left",e+2)},8)},IndexController.prototype.getQueryStringByName=function(t){var e=location.search.match(new RegExp("[?&]"+t+"=([^&]+)","i"));return null==e||e.length<1?"":e[1]},IndexController.prototype.tips=function(t){$("#tips").show(),$("#tips p").text(t)},IndexController.prototype.convertCanvasToImage=function(t){var e=new Image;return e.src=t.toDataURL("image/png"),e},$(document).ready(function(){new IndexController});