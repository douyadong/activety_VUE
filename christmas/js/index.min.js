function IndexController(){this.init(),this.bindEvent(),this.initLoading(),this.mySwiper2=null,this.mySwiper=null}IndexController.prototype.createMask=function(){var e=document.documentElement.scrollHeight,t=document.documentElement.scrollWidth,n=document.createElement("div");n.id="mask-container",$(n).css({"background-color":"rgba(0,0,0,0.7)",position:"fixed",left:0,top:0,height:e+"px",width:t+"px","z-index":"999",cursor:"pointer"}),$(document.body).append(n)},IndexController.prototype.init=function(){var e=this;$("[name='wechatUrl']").val(window.location.href);var t=e.getQueryStringByName("bg"),n=e.getQueryStringByName("text"),a=e.getQueryStringByName("name");if(t&&n&&a){$("#loading").hide(),$("#content").show(),$("#content").removeAttr("class").addClass(t),$("#menu").hide(),$("#content").attr("text",n);var o='<img src="images/'+n+'.png">                            <div>                                '+decodeURI(a)+"                            </div>";$("#content").find(".text").html("").html(o).find("div").show(),$("#makeup").show(),$("[name='text']").val(e.getQueryStringByName("text")),$("[name='username']").val(e.getQueryStringByName("name")),$("[name='wechatTitle']").val("Merry Christmas 我愿为你种星辰"),$("[name='wechatUrl']").val(window.location.href),e.html2Canvans(),$("#content").hide()}else $("#loading").show(),$("#content").hide()},IndexController.prototype.html2Canvans=function(){var e=this;html2canvas(document.body,{onrendered:function(t){document.body.appendChild(t);var n=e.convertCanvasToImage(document.getElementsByTagName("canvas")[0]);$(document.getElementsByTagName("canvas")[0]).hide(),$("body").append(n).addClass("save-img")}})},IndexController.prototype.initChooseBg=function(){var e=this;e.mySwiper=new Swiper("#swiperBg",{direction:"horizontal",loop:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",onSlideChangeEnd:function(e,t){var n=e.activeIndex;5==e.activeIndex&&(n=1),$(".text").html(""),$("#content").removeAttr("class").addClass("bg_"+n)}})},IndexController.prototype.initChooseText=function(){var e=this;e.mySwiper2=new Swiper("#swiperText",{direction:"horizontal",loop:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",onSlideChangeEnd:function(e,t){$("[name='username']").val("");var n=e.activeIndex;5==e.activeIndex&&(n=1);var a='<img src="images/text_'+n+'.png">                            <div>                                <div class="animate"><i></i>                                <input type="text" placeholder="输入姓名" id="name"></div>                                <p>(输入10个字符以内的名字)</p>                            </div>';$("#content").removeAttr("text").attr("text","text_"+n),$("#content").find(".text").html("").html(a)}})},IndexController.prototype.bindEvent=function(){var e=this;$("#menu a[data-number=1]").click(function(){$("#chooseBg").show(),$("#chooseText").hide(),$("[name='bg']").val("bg_1"),$("[name='text']").val(""),$(this).find(".tip").hide(),$("#mask-container").remove(),e.mySwiper||e.initChooseBg()}),$(".music").click(function(){"0"==$("#audio").attr("data-number")?(document.getElementById("audio").play(),$("#audio").attr("data-number","1")):(document.getElementById("audio").pause(),$("#audio").attr("data-number","0"))}),document.getElementsByTagName("body")[0].ontouchstart=function(){"0"==$("body").attr("data-number")&&document.getElementById("audio").play(),$("body").attr("data-number","1")},$("#menu a[data-number=2]").click(function(){$("#chooseText").show(),$("#chooseBg").hide(),$("#mask-container").remove(),$("#menu .tip").hide(),e.mySwiper2||e.initChooseText()}),$(".lick-btn").click(function(){var t=$(this).attr("data-number");"1"==t?($("[name = 'bg']").val($("#content").attr("class")),$("#chooseBg").hide(),e.createMask(),$("#menu .tip[data-number='2']").show()):($("[name = 'text']").val($("#content").attr("text")),$("#chooseText").hide(),$(".text > div").fadeIn("slow"))}),$("#start").click(function(){$("#loading").hide(),$("#content").fadeIn(),e.createMask(),$(".tip[data-number='1']").show()}),$("#showItems").click(function(){$("#items").fadeIn()}),$("#items").click(function(){$("#items").fadeOut()}),$("#submitContrct").click(function(){$("[name='contract']").is(":checked")?($("#contract").hide(),$("#content .text>div").html("").html($("[name='username']").val()),$("[name='wechatTitle']").val("Merry Christmas 我愿为你种星辰"),$("[name='wechatContent']").val($("[name='username']").val()+"已经把对你的祝福种进悟空「圣诞星辰卡」，快打开看看吧~"),$("[name='wechatUrl']").val(window.location.href+"?bg="+$("[name='bg']").val()+"&text="+$("[name='text']").val()+"&name="+$("[name='username']").val()),$("#menu").hide(),e.html2Canvans(),$("#content").hide(),$("#savePic").show(),$("#sendMess").show()):(e.tips("请勾选并同意！"),$("#contract").hide())}),$("body").delegate("#name","change",function(){$("[name='username']").val($(this).val())}),$("#guide").click(function(){$(this).hide()}),$("#tipsSubmit").click(function(){$("#tips").fadeOut(),$("[name='contract']").is(":checked")||$("#contract").show()}),window.addEventListener("resize",function(e){var t=$("#name");t[0].scrollIntoView(!1)}),$("body").delegate("#name","click",function(){$(this).parents(".animate").removeClass("animate")}),$("#sendMess").click(function(){$("#guide").fadeIn()}),$("#submit").click(function(){return $("[name='text']").val()?$("[name='username']").val()?$("#name").val().length>10?(e.tips("姓名最多10个字符!"),!1):void $("#contract").fadeIn():(e.tips("请填写姓名!"),!1):($(".tip").hide(),$("#mask-container").remove(),$("#chooseText").show(),e.mySwiper2||e.initChooseText(),!1)})},IndexController.prototype.initLoading=function(){var e=setInterval(function(){var t=$("#processInner").width(),n=parseInt($("#loadfont").text().split("%")[0]);if(t>=200){clearInterval(e),$("#man").fadeOut(),$("#process").fadeOut(),$("#loadfont").fadeOut();setTimeout(function(){$("#start").css("bottom","40px")},300)}else $("#processInner").width(t+2),$("#loadfont").text(n+1+"%"),$("#man img").css("margin-left",t+2)},8)},IndexController.prototype.getQueryStringByName=function(e){var t=location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==t||t.length<1?"":t[1]},IndexController.prototype.tips=function(e){$("#tips").show(),$("#tips p").text(e)},IndexController.prototype.convertCanvasToImage=function(e){var t=new Image;return t.src=e.toDataURL("image/png"),t},$(document).ready(function(){new IndexController});