function IndexController(){this.init(),this.bindEvent(),this.initLoading(),this.mySwiper2=null,this.mySwiper=null}IndexController.prototype.createMask=function(){var e=document.documentElement.scrollHeight,t=document.documentElement.scrollWidth,n=document.createElement("div");n.id="mask-container",$(n).css({"background-color":"rgba(0,0,0,0.7)",position:"fixed",left:0,top:0,height:e+"px",width:t+"px","z-index":"999",cursor:"pointer"}),$(document.body).append(n)},IndexController.prototype.init=function(){var e=this;$("[name='wechatUrl']").val(decodeURI(window.location.href));var t=e.getQueryStringByName("bg"),n=e.getQueryStringByName("guid"),a=e.getQueryStringByName("text"),o=e.getQueryStringByName("name");if(n&&t&&a&&o){$("#loading").hide(),$("#makeup").hide(),$("#content").show(),$("#content").removeAttr("class").addClass(t),$("#menu").hide(),$("#content").attr("text",a);var i='<img src="images/'+a+'.png">                            <div>                                '+decodeURI(o)+"                            </div>";$("#content").find(".text").html("").html(i).find("div").show(),$("[name='text']").val(a),$("[name='username']").val(decodeURI(o)),$("[name='wechatTitle']").val("Merry Christmas 我愿为你种星辰"),$("[name='wechatContent']").val(decodeURI(o)+"已经把对你的祝福种进悟空「圣诞星辰卡」，快打开看看吧~"),$(".text div").css("font-size","21px"),$(".music").hide();var r=$('<img class="save-img" src="'+n+'.jpg">');$("body").append(r),$("#makeup").show(),$("#content").hide(),$(".music").show()}else $("#loading").show(),$("#content").hide()},IndexController.prototype.html2Canvans=function(){var e=this;html2canvas(document.body,{onrendered:function(t){document.body.appendChild(t);var n=e.convertCanvasToImage(document.getElementsByTagName("canvas")[0]);$(n).addClass("save-img"),$(document.getElementsByTagName("canvas")[0]).hide(),$("body").append(n);var a={dataURI:$(".save-img").attr("src")};$.ajax({url:"save.php",type:"post",dataType:"json",data:a,success:function(e){1==e.status?($(".save-img").attr("src",e.GUID+".jpg"),$("[name='wechatUrl']").val(window.location.href+"?bg="+$("[name='bg']").val()+"&text="+$("[name='text']").val()+"&name="+$("[name='username']").val()+"&guid="+e.GUID)):alert(e.message)},error:function(){alert("生成失败:(")}})},width:2*document.documentElement.scrollWidth})},IndexController.prototype.initChooseBg=function(){var e=this;e.mySwiper=new Swiper("#swiperBg",{direction:"horizontal",loop:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",onSlideChangeEnd:function(e,t){var n=e.activeIndex;5==e.activeIndex&&(n=1),0==e.activeIndex&&(n=4),$("#content").removeAttr("class").addClass("bg_"+n)}})},IndexController.prototype.initChooseText=function(){var e=this;e.mySwiper2=new Swiper("#swiperText",{direction:"horizontal",loop:!0,nextButton:".swiper-button-next",prevButton:".swiper-button-prev",onSlideChangeEnd:function(e,t){$("[name='username']").val("");var n=e.activeIndex;5==e.activeIndex&&(n=1),0==e.activeIndex&&(n=4);var a='<img src="images/text_'+n+'.png">                            <div>                                <div class="animate"><i></i>                                <input type="text" placeholder="输入姓名" id="name"></div>                                <p>(输入10个字符以内的名字)</p>                            </div>';$("#content").removeAttr("text").attr("text","text_"+n),$("#content").find(".text").html("").html(a)}})},IndexController.prototype.bindEvent=function(){var e=this;$("#menu a[data-number=1]").click(function(){$("#chooseBg").show(),$("#chooseText").hide(),$("[name='bg']").val("bg_1"),$(this).find(".tip").hide(),$("#mask-container").remove(),e.mySwiper||e.initChooseBg()}),$(".music").click(function(){var e=$(this);"0"==$("#audio").attr("data-number")?"0"==e.attr("data-number")?(document.getElementById("audio").pause(),$("#audio").attr("data-number","1"),e.attr("data-number","1")):(document.getElementById("audio").play(),$("#audio").attr("data-number","1"),e.attr("data-number","0")):"0"==e.attr("data-number")?(document.getElementById("audio").pause(),$("#audio").attr("data-number","0"),e.attr("data-number","1")):(document.getElementById("audio").play(),e.attr("data-number","0"),$("#audio").attr("data-number","1"))}),document.getElementsByTagName("body")[0].ontouchstart=function(){var e=navigator.userAgent,t=!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);t&&("0"==$("body").attr("data-number")&&document.getElementById("audio").play(),$("body").attr("data-number","1"))},$("#menu a[data-number=2]").click(function(){$("#chooseText").show(),$("#chooseBg").hide(),$("#mask-container").remove(),$("#menu .tip").hide(),e.mySwiper2||e.initChooseText()}),$(".lick-btn").click(function(){var t=$(this).attr("data-number");"1"==t?($("[name = 'bg']").val($("#content").attr("class")),$("#chooseBg").hide(),$("[name='text']").val()||(e.createMask(),$("#menu .tip[data-number='2']").show())):($("[name = 'text']").val($("#content").attr("text")),$("#chooseText").hide(),$(".text > div").fadeIn("slow"))}),$("#start").click(function(){$("#loading").hide(),$("#content").fadeIn(),e.createMask(),$(".tip[data-number='1']").show()}),$("#showItems").click(function(){$("#items").fadeIn()}),$("#items").click(function(){$("#items").fadeOut()}),$("#submitContrct").click(function(){$("[name='contract']").is(":checked")?($("#mask-container").remove(),$("#contract").hide(),$("#content .text>div").html("").html($("[name='username']").val()),$("[name='wechatTitle']").val("Merry Christmas 我愿为你种星辰"),$("[name='wechatContent']").val($("[name='username']").val()+"已经把对你的祝福种进悟空「圣诞星辰卡」，快打开看看吧~"),$("#menu").hide(),$(".music").hide(),$(".text div").css("font-size","21px"),e.html2Canvans(),$(".music").show(),$("#content").hide(),$("#savePic").show(),$("#sendMess").show(),new WechatShareController):(e.tips("请勾选并同意！"),$("#contract").hide())}),$("body").delegate("#name","change",function(){$("[name='username']").val($(this).val())}),$("#guide").click(function(){$(this).hide(),$(".guide").show()}),$("#tipsSubmit").click(function(){$("#tips").fadeOut(),$("#mask-container").remove(),$("[name='contract']").is(":checked")||$("#contract").show()}),window.addEventListener("resize",function(e){var t=$("#name");t[0].scrollIntoView(!1)}),$("body").delegate("#name","click",function(){$(this).parents(".animate").removeClass("animate")}),$("#sendMess").click(function(){$("#guide").fadeIn(),$(".music").fadeOut()}),$("#submit").click(function(){if(!$("[name='text']").val())return $(".tip").hide(),$("#mask-container").remove(),$("#chooseText").show(),e.mySwiper2||e.initChooseText(),!1;if(!$("[name='username']").val())return e.tips("请填写姓名!"),!1;var t=/^[a-zA-Z\u4e00-\u9fa5]+$/;return t.test($("#name").val())?$("#name").val().length>10?(e.tips("姓名最多10个字符!"),!1):($("#contract").fadeIn(),e.createMask(),void $("#mask-container").css("z-index","1001")):(e.tips("请填写正确的姓名!"),!1)})},IndexController.prototype.initLoading=function(){var e=setInterval(function(){var t=$("#processInner").width(),n=parseInt($("#loadfont").text().split("%")[0]);if(t>=200){clearInterval(e),$("#man").fadeOut(),$("#process").fadeOut(),$("#loadfont").fadeOut();setTimeout(function(){$("#start").css("bottom","40px")},300)}else $("#processInner").width(t+2),$("#loadfont").text(n+1+"%"),$("#man img").css("margin-left",t+2)},8)},IndexController.prototype.getQueryStringByName=function(e){var t=location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==t||t.length<1?"":t[1]},IndexController.prototype.tips=function(e){var t=this;$("#tips").show(),$("#mask-container").length||t.createMask(),$("#mask-container").css("z-index","1001"),$("#tips p").text(e)},IndexController.prototype.convertCanvasToImage=function(e){var t=new Image;return t.src=e.toDataURL("image/png"),t},$(document).ready(function(){new IndexController});