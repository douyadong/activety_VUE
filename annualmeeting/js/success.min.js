/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
 1. 项目名称：点亮地图年会活动
 2. 页面路径：annualmeeting/success.php
 3. 作者：yuxiaochen@lifang.com
 -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
function PublishSuccessController() {
    /*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
     继承于Controller基类
     -----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
    Controller.call(this);

    /*-----------------------------------------------------------------------------------------------------------
    初始化页面
    -----------------------------------------------------------------------------------------------------------*/
    this.initPage();

    /*-----------------------------------------------------------------------------------------------------------
    初始化Swiper
    -----------------------------------------------------------------------------------------------------------*/
    this.initSwiper();

    /*-----------------------------------------------------------------------------------------------------------
    获取有发布过照片的用户显示最近一次发布的姓名和联系电话
    -----------------------------------------------------------------------------------------------------------*/
    this.getDetails();

    /*-----------------------------------------------------------------------------------------------------------
    绑定事件
    -----------------------------------------------------------------------------------------------------------*/
    this.bindEvent();
};


/*-----------------------------------------------------------------------------------------------------------
初始化页面
-----------------------------------------------------------------------------------------------------------*/
PublishSuccessController.prototype.initPage = function () {

    this.openId = "";
}

/*-----------------------------------------------------------------------------------------------------------
initSwiper
-----------------------------------------------------------------------------------------------------------*/
PublishSuccessController.prototype.initSwiper = function () {
    var classSelf = this;

    var mySwiper = new Swiper('.swiper-container', {
        direction: 'horizontal',
        loop: true,
        pagination: '.swiper-pagination'
    })
}


/*-----------------------------------------------------------------------------------------------------------
获取有发布过照片的用户显示最近一次发布的姓名和联系电话
-----------------------------------------------------------------------------------------------------------*/
PublishSuccessController.prototype.getDetails = function () {
    var classSelf = this;

    classSelf.request(classSelf.apiUrl.annualmeeting.getPhotoInfoByOpenId, {
        openId: classSelf.openId
    }, {
            process: function (resp) {
                if (resp && resp.length > 0) {
                    $('#txtUserName').val(resp[0].userName);
                    $('#txtMobile').val(resp[0].userPhone);
                }
            }
        })
}




//创建阴影层
PublishSuccessController.prototype.createMask = function () {
    //获取页面高度和宽度
    var sHeight = document.documentElement.scrollHeight,
        sWidth = document.documentElement.scrollWidth,
        mask = document.createElement('div');
    mask.id = 'mask-container';
    //遮罩层css
    $(mask).css({
        'background-color': 'rgba(0,0,0,0.7)',
        'position': 'fixed',
        'left': 0,
        'top': 0,
        'height': sHeight + 'px',
        'width': sWidth + 'px',
        'z-index': '1000',
        'cursor': 'pointer'
    });
    $(document.body).append(mask);
};


/*-----------------------------------------------------------------------------------------------------------
绑定事件
-----------------------------------------------------------------------------------------------------------*/
PublishSuccessController.prototype.bindEvent = function () {
    var classSelf = this;

    //上传按钮事件绑定
    $('.button').on('click', function () {

    })

    $('body').delegate('#mask-container', 'click', function (event) {
        $('.dialog').hide();
        $('#mask-container').remove();
    });
}



/*-----------------------------------------------------------------------------------------------------------------------------------------------------------------------
类的初始化
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------*/
$(document).ready(function () {
    new PublishSuccessController();
});
